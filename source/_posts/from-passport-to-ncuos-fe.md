---
title: 从「云家园」到「数字家园」，我们改变了什么？
keywords: Review
thumbnail: 'https://wzb-img-base.oss-cn-shanghai.aliyuncs.com/img/yunjiayuandaoshuzijiayuan.png'
tags: Review
categories:
  - Review
date: 2020-05-13 01:44:56
---

「云家园」是南昌大学的学生信息管理系统。「数字家园」是前者的项目升级。该项目在技术上与团队协同上做了诸多改进。

<!-- MORE -->

## 项目介绍

「云家园」是 2016 年开发的学生工作信息化系统，项目模块较多（ 80 +），某些模块需求变动频繁。用户组包含学生、辅导员、学工各层级领导，权限等级多。南昌大学学生信息化工作主要围绕此展开，服务重要，稳定性要求高。

「云家园」项目已经维护了多年，产生了诸多问题。故有了「数字家园」的诞生。2019 年下半年，「数字家园」项目启动，吸取老版「云家园」的经验，从各个维度上进行了优化与约束，保证项目质量。

下面是管理员页面截图。

![](https://wzb-img-base.oss-cn-shanghai.aliyuncs.com/img/IMG_20200513_002753.jpg)

![](https://wzb-img-base.oss-cn-shanghai.aliyuncs.com/img/20200513003111.png)

## 「云家园」时代

### 起源

「云家园」是 2016 年 10 月启动的项目。当年学长就选择使用 Vue.js 进行开发，十分佩服学长的技术嗅觉。2016 年 10 月正值 Vue.js 2.0 刚刚发布。Vue.js 的模块化思想与工程化体验的确让工作室的前端开发感受到了它的魅力。

不仅在前端方面，后端、部署、构建方面都有较多的优化实践。经过各种尝试，「云家园」项目的部署构建流程大致为：

+ 前端使用 Webpack 打包构建，构建产物手动上传至阿里云 OSS，并做好 CDN 加速
+ 后端多语言编写（ Java Python Go ）小模块，以 Docker 微服务方式进行部署

### 问题的产生

然而，经过几年众多开发人员的“洗礼”，它的代码已经不堪。类库乱引入、项目目录结构混乱（或者说，没有结构😊）。~~工作室里大家都戏称该项目为「💩山」~~

来看一些典型的问题：

+ 所有模块全部都堆砌在 src/components 文件夹下。中英文混合命名...（这个是最头大的，单看文件名完全不知道都是些什么模块。🤮）

<img src="https://wzb-img-base.oss-cn-shanghai.aliyuncs.com/img/20200513005728.png" style="zoom:50%;" />

+ 万物皆为 `null`

<img src="https://wzb-img-base.oss-cn-shanghai.aliyuncs.com/img/20200513010136.png" style="zoom:50%;" />

+ 代码不规范（缩进、大小写、空格等）

+ 代码耦合度高，可读性差

有时候，要找某个模块的 bug ，结果读大半天混乱的代码，“一怒之下”直接给它重构了。

> 这只是个别情况，但是混乱代码的确是普遍存在的。

自从见识过这个项目的代码，亲身体验了读 unreadable 代码的苦之后。感叹着——写代码注释，写风格好的代码，就是在行善积德，造福人类😊。从那之后，我也开始提高自己的代码风格与质量。

## 「数字家园」的诞生

2019 年底，由于种种原因。「云家园」项目需要重做。借着这个机会，我们吸取教训，防止新项目变成下一个「云家园」。

### 技术方案

经过几天的技术讨论、选型。最终确定了「数字家园」 的技术方案。（下面只列出前端部分）

+ 技术栈
  + React & TypeScript & UmiJS & DvaJS & Ant Design (Pro)
+ 工作流
  + 基于 GitFlow 进行开发，遵循 Conventional Commits 规范
  + 执行 Code Review 制度
+ 测试与约束
  + 编写必要的单元测试
  + 配置 eslint，未通过 lint 无法提交
+ 构建与发布流程
  + 使用 GitLab CI 进行构建，根据分支类型决定部署到测试环境 or 生产环境
  + 各种测试阶段通过之后才能进入生产环境
  + 生产环境部署到 阿里云 OSS，测试环境用 now 快速部署

+ 其他
  + 制定了[家园工作室前端代码风格指南](https://ncuhome.github.io/frontend-guide/)，并在团队内推广

### 改进

从上面的技术方案，很容易看出，从语言层面的 TypeScript 到 lint 测试，再到人工 Code Review ，都体现着对代码规范的高度重视。

另外，为了规避各种可能的 bug ，我们引入了单元测试，与测试环境。单元测试能直接地减少 bug。但是，至少目前，我们只需要编写**必要的**单元测试，因为开发周期太短。

另一个值得谈谈的部分是工作流上的改进。Code Review 制度不仅能减少 bug，还能让同学之间学习互相的代码，发现各自的不足。不过，凡是人为的流程，都是不可控的。若是 CR 人员混一混，甚至根本就不 CR，其实也没人发现。最后出现问题似乎也不能去 punish 同学。

学生社团不是公司，只能用爱发电，用心做事。

